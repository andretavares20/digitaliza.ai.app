import{a as l}from"./chunk-LOSE3ZCH.js";import{I as h,L as u,O as s,Ub as p,dc as g}from"./chunk-3BCS6XGD.js";function c(o){this.message=o}c.prototype=new Error,c.prototype.name="InvalidCharacterError";var f=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(o){var t=String(o).replace(/=+$/,"");if(t.length%4==1)throw new c("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,e,r=0,i=0,d="";e=t.charAt(i++);~e&&(n=r%4?64*n+e:e,r++%4)?d+=String.fromCharCode(255&n>>(-2*r&6)):0)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e);return d};function m(o){var t=o.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(n){return decodeURIComponent(f(n).replace(/(.)/g,function(e,r){var i=r.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}(t)}catch{return f(t)}}function a(o){this.message=o}function v(o,t){if(typeof o!="string")throw new a("Invalid token specified");var n=(t=t||{}).header===!0?0:1;try{return JSON.parse(m(o.split(".")[n]))}catch(e){throw new a("Invalid token specified: "+e.message)}}a.prototype=new Error,a.prototype.name="InvalidTokenError";var k=v;var E=(()=>{let t=class t{constructor(e,r){this.http=e,this.router=r,this.apiUrl=`${l.apiUrl}/api/auth`,this.clientUrl=`${l.apiUrl}/client/auth`,this.currentRole=null,this.currentUserId=null,this.initializeUserFromToken()}login(e){return this.http.post(`${this.clientUrl}/login`,e,{responseType:"text"}).pipe(h(r=>{r&&(this.saveToken(r),console.log("Token salvo:",r))}))}setSession(e){this.saveToken(e)}saveToken(e){localStorage.setItem("authToken",e),this.decodeToken()}decodeToken(){let e=this.getToken();if(e)try{let r=k(e);this.currentRole=r.role,this.currentUserId=r.userId,console.log("Decoded token:",r)}catch(r){console.error("Erro ao decodificar o token JWT:",r)}}initializeUserFromToken(){this.getToken()&&this.decodeToken()}getRole(){return this.currentRole}getUserId(){return this.currentUserId}logout(){localStorage.removeItem("authToken"),this.currentRole=null,this.currentUserId=null,this.router.navigate(["/auth/login"])}isLoggedIn(){return!!localStorage.getItem("authToken")}getToken(){return localStorage.getItem("authToken")}handleRoleRedirect(){let e=this.getRole();e==="ROLE_ADMIN"?this.router.navigate(["/admin/dashboard"]):e==="ROLE_USER"&&this.router.navigate(["/cliente/novo-pedido"])}verifyOrCreateUserByIdToken(e){return this.http.post(`${this.clientUrl}/google-login`,{idToken:e},{responseType:"text"})}};t.\u0275fac=function(r){return new(r||t)(s(p),s(g))},t.\u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();export{E as a};
